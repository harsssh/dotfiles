name: Notify dotfiles-private

on:
  workflow_run:
    workflows: [Nix Flake Check]
    types: [completed]
    branches: [main]

jobs:
  notify:
    if: github.event.workflow_run.conclusion == 'success' && github.event.workflow_run.event == 'push'
    runs-on: ubuntu-latest
    steps:
      - uses: actions/github-script@v7
        with:
          github-token: ${{ secrets.DOTFILES_PRIVATE_PAT }}
          script: |
            await github.rest.repos.createDispatchEvent({
              owner: 'harsssh',
              repo: 'dotfiles-private',
              event_type: 'dotfiles-updated'
            })
